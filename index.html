
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Aventures de Yann - Chasseur de Créatures</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2d3748, #1a202c);
            color: #e2e8f0;
            overflow: hidden;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #1a1a2e 0%, #16213e 30%, #0f3460 70%, #1a1a2e 100%);
            overflow: hidden;
        }

        /* Système de parallaxe avec SVG décors */
        .background-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0%;
            left: 0%;
            pointer-events: none;
            transition: transform 0.1s ease-out;
        }

        /* Couche de brouillard lointain */
        .fog-layer {
            background: radial-gradient(ellipse at center, rgba(100, 100, 120, 0.1) 0%, rgba(60, 60, 80, 0.05) 40%, transparent 80%);
            opacity: 0.3;
            z-index: 1;
            animation: fogDrift 20s ease-in-out infinite;
        }

        /* Montagnes sombres au loin */
        .mountain-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
        background: linear-gradient(to top, #0b132b 60%, transparent 100%);
        overflow: visible;
        }

        .mountain-layer::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 10%;
        width: 200px;
        height: 200px;
        background: #1c2541;
        clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        filter: drop-shadow(5px 5px 3px rgba(0,0,0,0.4));
        }

        /* Montagne secondaire */
        .mountain-layer::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 40%;
        width: 150px;
        height: 150px;
        background: #3a5068;
        clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        filter: drop-shadow(3px 3px 2px rgba(0,0,0,0.3));
        }

        .grave-marker {
            position: absolute;
            width: 50px;
            height: 90px;
            background: #2a2a2a;
            border-radius: 10px 10px 0 0;
            opacity: 0.8;
            box-shadow: inset 0 0 5px #1a1a1a;
        }

        .grave-marker::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 2px;
            background: #1a1a1a;
            border-radius: 1px;
        }

        .grave-marker::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 8px;
            background: #1a1a1a;
            border-radius: 1px;
        }


        /* Arbres morts et sombres */
        .tree-layer {
            z-index: 3;
            opacity: 0.8;
        }

        /* Chemins et ruines */
        .path-layer {
            z-index: 4;
            opacity: 0.9;
        }

        /* Structures au premier plan */
        .structure-layer {
            z-index: 5;
            opacity: 0.7;
        }

        /* Génération procédurale des décors */
        .tree {
            position: absolute;
            pointer-events: none;
        }

        .dead-tree {
            width: 100px;
            height: 150px;
            background: linear-gradient(to top, #2d2d2d 0%, #1a1a1a 70%, transparent 100%);
            clip-path: polygon(45% 0%, 55% 0%, 60% 20%, 70% 25%, 65% 30%, 75% 40%, 70% 45%, 80% 60%, 75% 65%, 52% 100%, 48% 100%, 25% 65%, 20% 60%, 30% 45%, 25% 40%, 35% 30%, 30% 25%, 40% 20%);
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }

        .dead-tree::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 20%;
            width: 20px;
            height: 30px;
            background: linear-gradient(45deg, transparent 0%, #1a1a1a 30%, transparent 70%);
            clip-path: polygon(0% 0%, 100% 50%, 0% 100%);
        }

        .dead-tree::after {
            content: '';
            position: absolute;
            top: 25%;
            right: 15%;
            width: 25px;
            height: 35px;
            background: linear-gradient(-45deg, transparent 0%, #1a1a1a 30%, transparent 70%);
            clip-path: polygon(100% 0%, 0% 50%, 100% 100%);
        }

        .twisted-tree {
            width: 80px;
            height: 140px;
            background: radial-gradient(ellipse at bottom, #2d2d2d 0%, #1a1a1a 60%, transparent 100%);
            clip-path: polygon(30% 0%, 70% 0%, 85% 15%, 75% 25%, 90% 35%, 80% 45%, 85% 60%, 75% 70%, 60% 100%, 40% 100%, 25% 70%, 15% 60%, 20% 45%, 10% 35%, 25% 25%, 15% 15%);
            transform: rotate(-5deg);
        }

        .house-distant {
            position: absolute;
            width: 40px;
            height: 35px;
            background: linear-gradient(to bottom, #2d2d3d 0%, #1a1a2a 100%);
            clip-path: polygon(0% 70%, 0% 100%, 100% 100%, 100% 70%, 85% 70%, 50% 30%, 15% 70%);
            opacity: 0.4;
            filter: blur(1px);
        }

        .house-distant::before {
            content: '';
            position: absolute;
            top: 60%;
            left: 20%;
            width: 8px;
            height: 12px;
            background: rgba(255, 200, 100, 0.3);
            border-radius: 2px;
        }

        .ruins {
            position: absolute;
            width: 30px;
            height: 50px;
            background: linear-gradient(to top, #3d3d3d 0%, #2d2d2d 70%, transparent 100%);
            clip-path: polygon(0% 100%, 0% 20%, 30% 0%, 70% 20%, 100% 0%, 100% 100%, 80% 100%, 80% 60%, 20% 60%, 20% 100%);
            opacity: 0.6;
        }

        .stone-path {
            position: absolute;
            width: 150px;
            height: 20px;
            background: linear-gradient(90deg, transparent 0%, rgba(100, 100, 100, 0.2) 30%, rgba(80, 80, 80, 0.3) 50%, rgba(100, 100, 100, 0.2) 70%, transparent 100%);
            border-radius: 10px;
            opacity: 0.4;
        }

        .mist {
            position: absolute;
            width: 200px;
            height: 100px;
            background: radial-gradient(ellipse at center, rgba(200, 200, 230, 0.1) 0%, rgba(150, 150, 180, 0.05) 50%, transparent 100%);
            border-radius: 50%;
            animation: mistFloat 15s ease-in-out infinite;
        }

        @keyframes fogDrift {
            0%, 100% { transform: translateX(0px); }
            50% { transform: translateX(30px); }
        }

        @keyframes mistFloat {
            0%, 100% { transform: translateY(0px) scale(1); opacity: 0.1; }
            50% { transform: translateY(-20px) scale(1.1); opacity: 0.2; }
        }

        /* Particules atmosphériques */
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(200, 200, 230, 0.3);
            border-radius: 50%;
            animation: float 10s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(50px); opacity: 0; }
        }

        /* Amélioration de l'interface pour l'ambiance sombre */
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 100;
        }

        .health-bar {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 200px;
            height: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #4a5568;
            border-radius: 10px;
            overflow: hidden;
            pointer-events: auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b0000, #dc143c);
            transition: width 0.3s ease;
        }

        .health-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            color: #e2e8f0;
        }

        .exp-bar {
            position: absolute;
            top: 50px;
            left: 20px;
            width: 200px;
            height: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #4a5568;
            border-radius: 8px;
            overflow: hidden;
            pointer-events: auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffb347);
            transition: width 0.3s ease;
        }

        .level-display {
            position: absolute;
            top: 75px;
            left: 20px;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            color: #ffd700;
        }

        .game-world {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .player {
            position: absolute;
            width: 50px;
            height: 80px;
            z-index: 10;
            transition: all 0.1s ease;
        }

        .player-head {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #deac88, #f1aa78);
            border-radius: 50%;
            border: 2px solid #654321;
        }

        .player-hair {
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 34px;
            height: 20px;
            background: #E6E6FA;
            border-radius: 50% 50% 30% 30%;
        }

        .player-eyes {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 8px;
        }

        .player-eyes::before,
        .player-eyes::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            top: 2px;
            box-shadow: 0 0 4px #FFD700;
        }

        .player-eyes::before {
            left: 3px;
        }

        .player-eyes::after {
            right: 3px;
        }

        .player-body {
            position: absolute;
            top: 28px;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 30px;
            background: linear-gradient(180deg, #2F4F4F, #1C1C1C);
            border-radius: 8px;
            border: 2px solid #4A4A4A;
        }

        .player-arms {
            position: absolute;
            top: 32px;
            left: 50%;
            transform: translateX(-50%);
            width: 45px;
            height: 20px;
        }

        .player-arms::before,
        .player-arms::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 22px;
            background: #dea277b7;
            border-radius: 4px;
            top: -2px;
        }

        .player-arms::before {
            left: -5px;
        }

        .player-arms::after {
            right: -5px;
        }

        .player-legs {
            position: absolute;
            top: 56px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 25px;
            background: linear-gradient(180deg, #2F4F4F, #1C1C1C);
            border-radius: 0 0 8px 8px;
        }

        .player-legs::before,
        .player-legs::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 15px;
            background: #dea277b7;
            border-radius: 0 0 4px 4px;
            bottom: -15px;
        }

        .player-legs::before {
            left: 4px;
        }

        .player-legs::after {
            right: 4px;
        }

        .knife {
            position: absolute;
            top: 35px;
            right: -20px;
            width: 4px;
            height: 25px;
            background: linear-gradient(180deg, #C0C0C0, #696969);
            border-radius: 2px;
            transform-origin: bottom center;
            transition: transform 0.2s ease;
            z-index: 11;
            box-shadow: 0 0 5px rgba(192, 192, 192, 0.5);
        }

        .knife::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -3px;
            width: 10px;
            height: 12px;
            background: #8B4513;
            border-radius: 3px;
            border: 1px solid #654321;
        }

        .knife::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -1px;
            width: 6px;
            height: 4px;
            background: #A0522D;
            border-radius: 2px;
        }

        .attacking .knife {
            transform: rotate(45deg);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }

        .creature {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #8b0000, #4b0000);
            border-radius: 50% 50% 30% 30%;
            transition: all 0.2s ease;
            z-index: 5;
            box-shadow: 0 0 15px rgba(139, 0, 0, 0.5);
        }

        .creature::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            width: 8px;
            height: 8px;
            background: #ff0000;
            border-radius: 50%;
            box-shadow: 20px 0 0 #ff0000, 0 0 10px #ff0000;
        }

        .creature::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 15px solid #8b0000;
        }

        .creature.damaged {
            animation: shake 0.3s ease-in-out;
        }

        .boss-creature {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #8B0000, #4B0000);
            border-radius: 50%;
            transition: all 0.2s ease;
            z-index: 5;
            border: 4px solid #FF0000;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.7);
        }

        .boss-creature::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            width: 12px;
            height: 12px;
            background: #FF4500;
            border-radius: 50%;
            box-shadow: 35px 0 0 #FF4500, 17px 10px 0 #FF0000, 0 0 15px #FF4500;
        }

        .boss-creature::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 25px solid #8B0000;
        }

        .story-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(25,25,25,0.98));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #e2e8f0;
            text-align: center;
            padding: 40px;
            box-sizing: border-box;
        }

        .story-title {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .story-text {
            font-size: 1.2em;
            line-height: 1.6;
            max-width: 800px;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .story-continue {
            padding: 15px 30px;
            background: linear-gradient(45deg, #8B0000, #4B0000);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.5);
        }

        .story-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 0, 0, 0.7);
        }

        .victory-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,50,0,0.9), rgba(0,100,0,0.8));
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #e2e8f0;
            text-align: center;
            padding: 40px;
            box-sizing: border-box;
        }

        .victory-title {
            font-size: 3.5em;
            font-weight: bold;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(45deg, #00FF00, #32CD32);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .level-complete {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #90EE90;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .next-level-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #32CD32, #228B22);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(50, 205, 50, 0.3);
            margin: 10px;
        }

        .creature.dead {
            opacity: 0.3;
            transform: scale(0.8);
        }

        .boss-creature.dead {
            opacity: 0.2;
            transform: scale(0.7);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            pointer-events: auto;
        }

        .control-btn {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #8B0000;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.3);
        }

        .control-btn:hover {
            background: rgba(139, 0, 0, 0.3);
            border-color: #FF0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .messages {
            position: absolute;
            top: 120px;
            left: 20px;
            width: 300px;
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #4a5568;
            border-radius: 8px;
            padding: 10px;
            font-size: 14px;
            pointer-events: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
        }

        .message {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 4px;
            animation: fadeIn 0.5s ease;
        }

        .message.combat {
            background: rgba(229, 62, 62, 0.2);
            border-left: 3px solid #e53e3e;
        }

        .message.exp {
            background: rgba(255, 215, 0, 0.2);
            border-left: 3px solid #FFD700;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .spawn-indicator {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 3px solid #ff6b6b;
            border-radius: 50%;
            animation: pulse 1s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-world" id="gameWorld" style="position: relative; width: 100vw; height: 100vh; overflow: hidden;">
          
          <div class="background-layer mountain-layer"></div>
          <div class="background-layer fog-layer"></div>
      
          <div class="background-layer tree-layer" id="treeLayer"></div>
          <div class="background-layer path-layer" id="pathLayer"></div>
          <div class="background-layer structure-layer" id="structureLayer"></div>
      
        </div>
  
      

            <div class="player" id="player">
                <div class="player-hair"></div>
                <div class="player-head"></div>
                <div class="player-eyes"></div>
                <div class="player-body"></div>
                <div class="player-arms"></div>
                <div class="player-legs"></div>
                <div class="knife"></div>
            </div>
        </div>

        <div class="story-screen" id="storyScreen">
            <div class="story-title">Les Aventures de Yann</div>
            <div class="story-text">
                <p>Dans les terres maudites de Velen, autrefois fertiles et prospères, Yann était un simple architecte qui menait une vie paisible. Ses chantiers s'étendaient à perte de vue, bordés par des forêts verdoyantes et des collines paisibles.</p>
                
                <p>Mais la guerre a tout changé. Les armées sont passées, laissant derrière elles désolation et corruption. Une malédiction sombre s'est abattue sur ces terres, transformant les forêts en cimetières d'arbres morts, les rivières en marécages empoisonnés, et les villages en ruines hantées.</p>
                
                <p>Yann, armé de son vieux couteau et portant dans ses yeux la lueur dorée de ceux qui ont côtoyé la magie, s'aventure maintenant dans ces terres désolées. Les créatures corrompues rôdent dans l'ombre des arbres morts, et les brumes toxiques dansent entre les ruines.</p>
                
                <p>La route sera longue et périlleuse, mais Yann ne peut abandonner sa quête. Il doit purifier ces terres et restaurer l'équilibre naturel, ou périr dans cette tentative...</p>
            </div>
            <button class="story-continue" onclick="startGame()">Commencer la Chasse</button>
        </div>

        <div class="victory-screen" id="victoryScreen">
            <div class="victory-title">NIVEAU TERMINÉ !</div>
            <div class="level-complete">Félicitations ! Yann a survécu à cette épreuve.</div>
            <div class="story-text">
                <p>Les créatures de cette zone ont été éliminées, mais les murmures du vent portent encore l'écho d'une malédiction plus profonde. Au cœur de la forêt maudite, une entité ancienne attend, gardienne de ces terres corrompues.</p>
                
                <p>Le véritable défi commence maintenant...</p>
            </div>
            <button class="next-level-btn" onclick="startLevel2()">Affronter l'Entité</button>
            <button class="next-level-btn" onclick="restartGame()">Recommencer</button>
        </div>

        <div class="ui-overlay">
            <div class="health-bar">
                <div class="health-fill" id="healthFill"></div>
                <div class="health-text" id="healthText">100/100</div>
            </div>
            
            <div class="exp-bar">
                <div class="exp-fill" id="expFill"></div>
            </div>
            
            <div class="level-display" id="levelDisplay">Niveau 1</div>
            
            <div class="messages" id="messages"></div>
            
            <div class="controls">
                <button class="control-btn" id="attackBtn">Attaquer (Espace)</button>
                <button class="control-btn" id="healBtn">Soigner (H)</button>
            </div>
        </div>
    </div>

    <script>

        let game = null;

        function startGame() {
            // Cacher l'écran d'intro
            const storyScreen = document.getElementById('storyScreen');
            if(storyScreen) storyScreen.style.display = 'none';

            // Lancer le jeu
            if (!game) {
                game = new Game();
            } else {
                game.gameRunning = true;
                game.updateUI();
                game.gameLoop();
            }
        }

        class Game {
            constructor() {
                this.player = {
                    x: 100,
                    y: 100,
                    health: 100,
                    maxHealth: 100,
                    level: 1,
                    exp: 0,
                    expToNext: 100,
                    attacking: false,
                    speed: 3
                };
                
                this.creatures = [];
                this.keys = {};
                this.lastCreatureSpawn = 0;
                this.creatureSpawnRate = 3000;
                this.gameRunning = true;
                this.monstersKilled = 0;
                this.monstersSpawned = 0;
                this.totalMonstersToKill = 10;
                
                this.initializeElements();
                this.generateDecor();
                this.bindEvents();
                this.updateUI();
                this.gameLoop();
                
                this.addMessage("Yann se réveille dans une forêt mystérieuse...", "");
                this.addMessage("Des créatures rôdent dans l'obscurité. Restez vigilant!", "combat");
            }

            generateDecor() {
                const treeLayer = document.getElementById('treeLayer');
                const structureLayer = document.getElementById('structureLayer');
                const pathLayer = document.getElementById('pathLayer');

                // Vider les couches avant génération
                treeLayer.innerHTML = '';
                structureLayer.innerHTML = '';
                pathLayer.innerHTML = '';

                const container = document.querySelector('.game-container');
                const maxWidth = container.clientWidth;
                const maxHeight = container.clientHeight;

                function randomPos(elementWidth, elementHeight, margin = 20) {
                    const x = margin + Math.random() * (maxWidth - elementWidth - 2 * margin);
                    const y = margin + Math.random() * (maxHeight - elementHeight - 2 * margin);
                    return { x, y };
                }

                // Arbres morts (100x150)
                for (let i = 0; i < 25; i++) {
                    const tree = document.createElement('div');
                    tree.classList.add('tree', Math.random() > 0.6 ? 'twisted-tree' : 'dead-tree');
                    tree.style.position = 'absolute';

                    const size = { w: 100, h: 150 };
                    const pos = randomPos(size.w, size.h, 30);
                    tree.style.left = pos.x + 'px';
                    tree.style.top = pos.y + 'px';

                    tree.style.transform = `rotate(${Math.random() * 30 - 15}deg) scale(${0.8 + Math.random() * 0.4})`;

                    treeLayer.appendChild(tree);
                }

                // Buissons flétris (30x25)
                for (let i = 0; i < 15; i++) {
                    const bush = document.createElement('div');
                    bush.classList.add('withered-bush');
                    bush.style.position = 'absolute';

                    const size = { w: 30, h: 25 };
                    const pos = randomPos(size.w, size.h, 20);
                    bush.style.left = pos.x + 'px';
                    bush.style.top = pos.y + 'px';

                    bush.style.transform = `scale(${0.7 + Math.random() * 0.5})`;

                    treeLayer.appendChild(bush);
                }

                // Maisons lointaines (40x35)
                for (let i = 0; i < 5; i++) {
                    const house = document.createElement('div');
                    house.classList.add('house-distant');
                    house.style.position = 'absolute';

                    const size = { w: 40, h: 35 };
                    const pos = randomPos(size.w, size.h, 30);
                    house.style.left = pos.x + 'px';
                    house.style.top = pos.y + 'px';

                    structureLayer.appendChild(house);
                }

                // Ruines (30x50)
                for (let i = 0; i < 8; i++) {
                    const ruin = document.createElement('div');
                    ruin.classList.add('ruins');
                    ruin.style.position = 'absolute';

                    const size = { w: 30, h: 50 };
                    const pos = randomPos(size.w, size.h, 40);
                    ruin.style.left = pos.x + 'px';
                    ruin.style.top = pos.y + 'px';

                    ruin.style.transform = `rotate(${Math.random() * 20 - 10}deg) scale(${0.9 + Math.random() * 0.3})`;

                    structureLayer.appendChild(ruin);
                }

                // Tombes (50x90)
                for (let i = 0; i < 10; i++) {
                    const grave = document.createElement('div');
                    grave.classList.add('grave-marker');
                    grave.style.position = 'absolute';

                    const size = { w: 50, h: 90 };
                    const pos = randomPos(size.w, size.h, 40);
                    grave.style.left = pos.x + 'px';
                    grave.style.top = pos.y + 'px';

                    grave.style.transform = `rotate(${Math.random() * 30 - 15}deg) scale(${0.8 + Math.random() * 0.4})`;

                    structureLayer.appendChild(grave);
                }

                // Chemins (150x20)
                for (let i = 0; i < 6; i++) {
                    const path = document.createElement('div');
                    path.classList.add('stone-path');
                    path.style.position = 'absolute';

                    const size = { w: 150, h: 20 };
                    const pos = randomPos(size.w, size.h, 50);
                    path.style.left = pos.x + 'px';
                    path.style.top = pos.y + 'px';

                    path.style.transform = `rotate(${Math.random() * 30 - 15}deg) scale(${0.9 + Math.random() * 0.3})`;

                    pathLayer.appendChild(path);
                }
            }






            updateBackgroundPosition() {
                const fog = document.querySelector('.fog-layer');
                const mountain = document.querySelector('.mountain-layer');
                const trees = document.querySelector('.tree-layer');
                const path = document.querySelector('.path-layer');
                const structure = document.querySelector('.structure-layer');

                if (fog) fog.style.transform = `translate(${this.player.x * -0.01}px, ${this.player.y * -0.005}px)`;
                if (mountain) mountain.style.transform = `translate(${this.player.x * -0.02}px, ${this.player.y * -0.01}px)`;
                if (trees) trees.style.transform = `translate(${this.player.x * -0.05}px, ${this.player.y * -0.025}px)`;
                if (path) path.style.transform = `translate(${this.player.x * -0.1}px, ${this.player.y * -0.05}px)`;
                if (structure) structure.style.transform = `translate(${this.player.x * -0.15}px, ${this.player.y * -0.075}px)`;
            }


            
            initializeElements() {
                this.playerEl = document.getElementById('player');
                this.gameWorld = document.getElementById('gameWorld');
                this.healthFill = document.getElementById('healthFill');
                this.healthText = document.getElementById('healthText');
                this.expFill = document.getElementById('expFill');
                this.levelDisplay = document.getElementById('levelDisplay');
                this.messages = document.getElementById('messages');
                this.attackBtn = document.getElementById('attackBtn');
                this.healBtn = document.getElementById('healBtn');
            }
            
            bindEvents() {
                document.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                    
                    if (e.key === ' ') {
                        e.preventDefault();
                        this.attack();
                    }
                    if (e.key.toLowerCase() === 'h') {
                        this.heal();
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                this.attackBtn.addEventListener('click', () => this.attack());
                this.healBtn.addEventListener('click', () => this.heal());
            }
            
            movePlayer() {
                let dx = 0, dy = 0;
                
                if (this.keys['arrowleft'] || this.keys['q']) dx -= this.player.speed;
                if (this.keys['arrowright'] || this.keys['d']) dx += this.player.speed;
                if (this.keys['arrowup'] || this.keys['z']) dy -= this.player.speed;
                if (this.keys['arrowdown'] || this.keys['s']) dy += this.player.speed;
                
                this.player.x = Math.max(0, Math.min(window.innerWidth - 40, this.player.x + dx));
                this.player.y = Math.max(0, Math.min(window.innerHeight - 60, this.player.y + dy));
                
                this.playerEl.style.left = this.player.x + 'px';
                this.playerEl.style.top = this.player.y + 'px';
            }
            
            attack() {
                if (this.player.attacking) return;
                
                this.player.attacking = true;
                this.playerEl.classList.add('attacking');
                
                const attackRange = 80;
                let hitCreature = false;
                
                this.creatures.forEach((creature, index) => {
                    if (creature.dead) return;
                    
                    const distance = Math.sqrt(
                        Math.pow(creature.x - this.player.x, 2) + 
                        Math.pow(creature.y - this.player.y, 2)
                    );
                    
                    if (distance <= attackRange) {
                        creature.health -= 25 + (this.player.level * 5);
                        creature.element.classList.add('damaged');
                        hitCreature = true;
                        
                        setTimeout(() => {
                            creature.element.classList.remove('damaged');
                        }, 300);
                        
                        if (creature.health <= 0) {
                            this.killCreature(index);
                        }
                    }
                });
                
                if (hitCreature) {
                    this.addMessage(`Yann frappe avec son couteau! Coup critique!`, "combat");
                } else {
                    this.addMessage("Yann frappe dans le vide...", "");
                }
                
                setTimeout(() => {
                    this.player.attacking = false;
                    this.playerEl.classList.remove('attacking');
                }, 400);
            }

            
            heal() {
                if (this.player.health >= this.player.maxHealth) {
                    this.addMessage("Yann est déjà en pleine forme!", "");
                    return;
                }
                
                const healAmount = 30 + (this.player.level * 5);
                this.player.health = Math.min(this.player.maxHealth, this.player.health + healAmount);
                this.addMessage(`Yann récupère ${healAmount} points de vie!`, "exp");
                this.updateUI();
            }
            
            spawnCreature() {
                // Limite sur le total des monstres générés
                if (this.monstersSpawned >= this.totalMonstersToKill) return;

                const creature = {
                    x: Math.random() * (window.innerWidth - 50),
                    y: Math.random() * (window.innerHeight - 50),
                    health: 50 + (this.player.level * 10),
                    maxHealth: 50 + (this.player.level * 10),
                    speed: 1 + (this.player.level * 0.2),
                    dead: false,
                    element: document.createElement('div')
                };

                // Éviter de spawn trop près du joueur
                const minDistance = 150;
                const distance = Math.sqrt(
                    Math.pow(creature.x - this.player.x, 2) + 
                    Math.pow(creature.y - this.player.y, 2)
                );

                if (distance < minDistance) {
                    creature.x = this.player.x + (Math.random() > 0.5 ? minDistance : -minDistance);
                    creature.y = this.player.y + (Math.random() > 0.5 ? minDistance : -minDistance);
                }

                creature.element.className = 'creature';
                creature.element.style.left = creature.x + 'px';
                creature.element.style.top = creature.y + 'px';

                this.gameWorld.appendChild(creature.element);
                this.creatures.push(creature);

                this.monstersSpawned++;  // ++ ici

                this.addMessage("Une créature mystérieuse apparaît!", "combat");
            }

            
            moveCreatures() {
                this.creatures.forEach(creature => {
                    if (creature.dead) return;
                    
                    const dx = this.player.x - creature.x;
                    const dy = this.player.y - creature.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 0) {
                        creature.x += (dx / distance) * creature.speed;
                        creature.y += (dy / distance) * creature.speed;
                        
                        creature.element.style.left = creature.x + 'px';
                        creature.element.style.top = creature.y + 'px';
                    }
                    
                    // Attaque du joueur
                    if (distance < 40) {
                        this.player.health -= 1;
                        if (this.player.health <= 0) {
                            this.gameOver();
                        }
                    }
                });
            }

            victory() {
                this.gameRunning = false;

                const victoryScreen = document.getElementById('victoryScreen');
                
                if (!victoryScreen) {
                    const newVictoryScreen = document.createElement('div');
                    newVictoryScreen.id = 'victoryScreen';
                    document.body.appendChild(newVictoryScreen);
                }

                // Cache le monde de jeu et le joueur
                document.getElementById('gameWorld').style.display = 'none';
                document.getElementById('player').style.display = 'none';
                
                const screen = document.getElementById('victoryScreen');
                screen.style.display = 'flex';
                screen.style.position = 'fixed';
                screen.style.top = '0';
                screen.style.left = '0';
                screen.style.width = '100vw';
                screen.style.height = '100vh';
                screen.style.background = 'linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%)';
                screen.style.flexDirection = 'column';
                screen.style.justifyContent = 'center';
                screen.style.alignItems = 'center';
                screen.style.color = '#e2e8f0';
                screen.style.zIndex = '2000';
                screen.style.padding = '20px';
                screen.style.boxSizing = 'border-box';
                screen.style.fontFamily = 'Georgia, serif';
                screen.style.overflow = 'hidden';
                
                screen.innerHTML = `
                    <style>
                        @keyframes fadeIn {
                            from { opacity: 0; transform: translateY(30px); }
                            to { opacity: 1; transform: translateY(0); }
                        }
                        @keyframes glow {
                            0%, 100% { box-shadow: 0 0 20px rgba(155, 48, 255, 0.3); }
                            50% { box-shadow: 0 0 30px rgba(155, 48, 255, 0.6); }
                        }
                        @keyframes sparkle {
                            0%, 100% { transform: scale(1) rotate(0deg); }
                            50% { transform: scale(1.1) rotate(180deg); }
                        }
                        .victory-content {
                            animation: fadeIn 2s ease-out;
                            text-align: center;
                            max-width: 800px;
                        }
                        .magic-particles {
                            position: absolute;
                            width: 4px;
                            height: 4px;
                            background: #9b30ff;
                            border-radius: 50%;
                            animation: sparkle 3s infinite;
                        }
                    </style>
                    
                    <!-- Particules magiques -->
                    <div class="magic-particles" style="top: 20%; left: 10%; animation-delay: 0s;"></div>
                    <div class="magic-particles" style="top: 30%; right: 15%; animation-delay: 1s;"></div>
                    <div class="magic-particles" style="bottom: 25%; left: 20%; animation-delay: 2s;"></div>
                    <div class="magic-particles" style="bottom: 35%; right: 25%; animation-delay: 0.5s;"></div>
                    
                    <div class="victory-content">
                        <h1 style="
                            font-size: 4em; 
                            margin-bottom: 30px;
                            background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
                            -webkit-background-clip: text;
                            -webkit-text-fill-color: transparent;
                            background-clip: text;
                            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
                            font-weight: bold;
                        ">VICTOIRE</h1>
                        
                        <p style="
                            max-width: 600px; 
                            font-size: 1.3em; 
                            margin-bottom: 50px;
                            line-height: 1.6;
                            color: #c8d6e5;
                            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        ">
                            Yann a éliminé toutes les créatures maléfiques. Dans un tourbillon de magie violette, 
                            <span style="color: #9b30ff; font-weight: bold;">Yennefer de Vengerberg</span> apparaît pour le féliciter.
                        </p>
                        
                        <div style="
                            display: flex; 
                            flex-direction: column; 
                            align-items: center;
                            position: relative;
                        ">
                            <!-- Yennefer redessinée -->
                            <div id="yennefer" style="
                                width: 200px; 
                                height: 350px; 
                                position: relative;
                                animation: glow 4s infinite;
                                margin-bottom: 40px;
                            ">
                                <!-- Aura magique -->
                                <div style="
                                    position: absolute;
                                    top: -20px;
                                    left: -20px;
                                    right: -20px;
                                    bottom: -20px;
                                    background: radial-gradient(circle, rgba(155, 48, 255, 0.1) 0%, transparent 70%);
                                    border-radius: 50%;
                                    z-index: 1;
                                "></div>
                                
                                <!-- Corps principal -->
                                <div style="
                                    position: relative;
                                    z-index: 2;
                                    height: 100%;
                                ">
                                    <!-- Cheveux noirs ondulés -->
                                    <div style="
                                        position: absolute;
                                        top: 10px;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        width: 140px;
                                        height: 180px;
                                        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
                                        border-radius: 50% 50% 45% 45% / 60% 60% 40% 40%;
                                        box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
                                    ">
                                        <!-- Mèches de cheveux -->
                                        <div style="
                                            position: absolute;
                                            top: 20px;
                                            left: -10px;
                                            width: 30px;
                                            height: 60px;
                                            background: linear-gradient(45deg, #2d2d2d, #1a1a1a);
                                            border-radius: 50% 20% 50% 20%;
                                            transform: rotate(-20deg);
                                        "></div>
                                        <div style="
                                            position: absolute;
                                            top: 20px;
                                            right: -10px;
                                            width: 30px;
                                            height: 60px;
                                            background: linear-gradient(45deg, #2d2d2d, #1a1a1a);
                                            border-radius: 20% 50% 20% 50%;
                                            transform: rotate(20deg);
                                        "></div>
                                    </div>
                                    
                                    <!-- Visage -->
                                    <div style="
                                        position: absolute;
                                        top: 50px;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        width: 100px;
                                        height: 120px;
                                        background: linear-gradient(135deg, #fce4d6 0%, #f4d3c1 50%, #e8c4a0 100%);
                                        border-radius: 50% 50% 45% 45% / 60% 60% 40% 40%;
                                        box-shadow: 0 5px 20px rgba(0,0,0,0.2), inset 0 2px 8px rgba(255,255,255,0.3);
                                        z-index: 3;
                                    ">
                                        <!-- Reflet sur le front -->
                                        <div style="
                                            position: absolute;
                                            top: 15px;
                                            left: 50%;
                                            transform: translateX(-50%);
                                            width: 40px;
                                            height: 20px;
                                            background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, transparent 100%);
                                            border-radius: 50%;
                                            filter: blur(3px);
                                        "></div>
                                        
                                        <!-- Yeux violets lumineux avec cils -->
                                        <div style="
                                            position: absolute;
                                            top: 40px;
                                            left: 18px;
                                            width: 18px;
                                            height: 22px;
                                            background: radial-gradient(circle, #b347ff 0%, #9b30ff 30%, #6a0dad 100%);
                                            border-radius: 50%;
                                            box-shadow: 0 0 20px #9b30ff, inset 0 0 5px rgba(255,255,255,0.4);
                                        ">
                                            <!-- Reflet dans l'œil -->
                                            <div style="
                                                position: absolute;
                                                top: 3px;
                                                left: 3px;
                                                width: 6px;
                                                height: 6px;
                                                background: rgba(255,255,255,0.8);
                                                border-radius: 50%;
                                            "></div>
                                            <!-- Cils supérieurs -->
                                            <div style="
                                                position: absolute;
                                                top: -5px;
                                                left: 50%;
                                                transform: translateX(-50%);
                                                width: 20px;
                                                height: 8px;
                                                background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
                                                border-radius: 50% 50% 20% 20%;
                                            "></div>
                                        </div>
                                        <div style="
                                            position: absolute;
                                            top: 40px;
                                            right: 18px;
                                            width: 18px;
                                            height: 22px;
                                            background: radial-gradient(circle, #b347ff 0%, #9b30ff 30%, #6a0dad 100%);
                                            border-radius: 50%;
                                            box-shadow: 0 0 20px #9b30ff, inset 0 0 5px rgba(255,255,255,0.4);
                                        ">
                                            <!-- Reflet dans l'œil -->
                                            <div style="
                                                position: absolute;
                                                top: 3px;
                                                right: 3px;
                                                width: 6px;
                                                height: 6px;
                                                background: rgba(255,255,255,0.8);
                                                border-radius: 50%;
                                            "></div>
                                            <!-- Cils supérieurs -->
                                            <div style="
                                                position: absolute;
                                                top: -5px;
                                                left: 50%;
                                                transform: translateX(-50%);
                                                width: 20px;
                                                height: 8px;
                                                background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
                                                border-radius: 50% 50% 20% 20%;
                                            "></div>
                                        </div>
                                        
                                        <!-- Sourcils parfaitement dessinés -->
                                        <div style="
                                            position: absolute;
                                            top: 28px;
                                            left: 15px;
                                            width: 22px;
                                            height: 4px;
                                            background: linear-gradient(135deg, #3d3d3d 0%, #2d2d2d 100%);
                                            border-radius: 50%;
                                            transform: rotate(-8deg);
                                            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
                                        "></div>
                                        <div style="
                                            position: absolute;
                                            top: 28px;
                                            right: 15px;
                                            width: 22px;
                                            height: 4px;
                                            background: linear-gradient(135deg, #3d3d3d 0%, #2d2d2d 100%);
                                            border-radius: 50%;
                                            transform: rotate(8deg);
                                            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
                                        "></div>
                                        
                                        <!-- Nez délicat -->
                                        <div style="
                                            position: absolute;
                                            top: 58px;
                                            left: 50%;
                                            transform: translateX(-50%);
                                            width: 8px;
                                            height: 18px;
                                            background: linear-gradient(135deg, #f4d3c1, #e8c4a0);
                                            border-radius: 30% 30% 50% 50%;
                                            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                                        ">
                                            <!-- Narines subtiles -->
                                            <div style="
                                                position: absolute;
                                                bottom: 2px;
                                                left: 1px;
                                                width: 2px;
                                                height: 3px;
                                                background: rgba(0,0,0,0.1);
                                                border-radius: 50%;
                                            "></div>
                                            <div style="
                                                position: absolute;
                                                bottom: 2px;
                                                right: 1px;
                                                width: 2px;
                                                height: 3px;
                                                background: rgba(0,0,0,0.1);
                                                border-radius: 50%;
                                            "></div>
                                        </div>
                                        
                                        <!-- Pommettes -->
                                        <div style="
                                            position: absolute;
                                            top: 65px;
                                            left: 8px;
                                            width: 15px;
                                            height: 8px;
                                            background: linear-gradient(135deg, rgba(255,182,193,0.3) 0%, transparent 100%);
                                            border-radius: 50%;
                                            filter: blur(2px);
                                        "></div>
                                        <div style="
                                            position: absolute;
                                            top: 65px;
                                            right: 8px;
                                            width: 15px;
                                            height: 8px;
                                            background: linear-gradient(135deg, rgba(255,182,193,0.3) 0%, transparent 100%);
                                            border-radius: 50%;
                                            filter: blur(2px);
                                        "></div>
                                        
                                        <!-- Bouche pulpeuse -->
                                        <div style="
                                            position: absolute;
                                            bottom: 22px;
                                            left: 50%;
                                            transform: translateX(-50%);
                                            width: 28px;
                                            height: 10px;
                                            background: linear-gradient(135deg, #d63384 0%, #c44569 50%, #a73653 100%);
                                            border-radius: 50% 50% 45% 45% / 60% 60% 40% 40%;
                                            box-shadow: 0 2px 5px rgba(0,0,0,0.2), inset 0 1px 3px rgba(255,255,255,0.3);
                                        ">
                                            <!-- Reflet sur la lèvre -->
                                            <div style="
                                                position: absolute;
                                                top: 1px;
                                                left: 50%;
                                                transform: translateX(-50%);
                                                width: 12px;
                                                height: 3px;
                                                background: rgba(255,255,255,0.4);
                                                border-radius: 50%;
                                                filter: blur(1px);
                                            "></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Robe violette élégante -->
                                    <div style="
                                        position: absolute;
                                        bottom: 0;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        width: 180px;
                                        height: 200px;
                                        background: linear-gradient(135deg, #4B0082 0%, #8A2BE2 50%, #9370DB 100%);
                                        border-radius: 40% 40% 20% 20% / 60% 60% 20% 20%;
                                        box-shadow: 0 0 25px rgba(123, 104, 238, 0.4);
                                    ">
                                        <!-- Détails de la robe -->
                                        <div style="
                                            position: absolute;
                                            top: 20px;
                                            left: 50%;
                                            transform: translateX(-50%);
                                            width: 20px;
                                            height: 40px;
                                            background: linear-gradient(135deg, #9b30ff, #6a0dad);
                                            border-radius: 50%;
                                            box-shadow: 0 0 10px #9b30ff;
                                        "></div>
                                    </div>
                                    
                                    <!-- Bras -->
                                    <div style="
                                        position: absolute;
                                        top: 140px;
                                        left: 10px;
                                        width: 25px;
                                        height: 80px;
                                        background: linear-gradient(135deg, #f4c2a1, #e8b08a);
                                        border-radius: 50% 50% 20% 20%;
                                        transform: rotate(-15deg);
                                    "></div>
                                    <div style="
                                        position: absolute;
                                        top: 140px;
                                        right: 10px;
                                        width: 25px;
                                        height: 80px;
                                        background: linear-gradient(135deg, #f4c2a1, #e8b08a);
                                        border-radius: 50% 50% 20% 20%;
                                        transform: rotate(15deg);
                                    "></div>
                                </div>
                            </div>
                            
                            <!-- Citation de Yennefer -->
                            <div style="
                                background: rgba(155, 48, 255, 0.1);
                                border: 2px solid #9b30ff;
                                border-radius: 15px;
                                padding: 20px;
                                margin-bottom: 40px;
                                max-width: 500px;
                                position: relative;
                            ">
                                <p style="
                                    font-style: italic;
                                    font-size: 1.1em;
                                    color: #e2e8f0;
                                    margin: 0;
                                    text-align: center;
                                ">
                                    "Impressionnant, Yann. Tu as prouvé que même les créatures les plus sombres 
                                    ne peuvent résister à un cœur déterminé."
                                </p>
                                <div style="
                                    position: absolute;
                                    bottom: -10px;
                                    left: 50%;
                                    transform: translateX(-50%);
                                    width: 0;
                                    height: 0;
                                    border-left: 15px solid transparent;
                                    border-right: 15px solid transparent;
                                    border-top: 15px solid #9b30ff;
                                "></div>
                            </div>
                            
                            <button style="
                                margin-top: 20px;
                                padding: 18px 50px;
                                font-size: 1.3em;
                                font-weight: bold;
                                border: none;
                                border-radius: 15px;
                                background: linear-gradient(135deg, #6A0DAD 0%, #8A2BE2 50%, #9370DB 100%);
                                color: white;
                                cursor: pointer;
                                box-shadow: 0 8px 25px rgba(155, 48, 255, 0.4);
                                transition: all 0.3s ease;
                                font-family: Georgia, serif;
                                text-transform: uppercase;
                                letter-spacing: 1px;
                            " id="restartBtn" 
                            onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 35px rgba(155, 48, 255, 0.6)';"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(155, 48, 255, 0.4)';">
                                ⚔️ Nouvelle Quête
                            </button>
                        </div>
                    </div>
                `;

                document.getElementById('restartBtn').onclick = () => {
                    location.reload();
                };
            }

            
            killCreature(index) {
                const creature = this.creatures[index];
                creature.dead = true;
                creature.element.classList.add('dead');

                const expGain = 25 + (this.player.level * 5);
                this.player.exp += expGain;

                this.monstersKilled++;

                this.addMessage(`Créature éliminée! +${expGain} XP (${this.monstersKilled}/${this.totalMonstersToKill})`, "exp");

                if (this.monstersKilled >= this.totalMonstersToKill) {
                    console.log('Victoire détectée!');
                    this.victory();
                    return;
                }


                if (this.player.exp >= this.player.expToNext) {
                    this.levelUp();
                }

                setTimeout(() => {
                    creature.element.remove();
                    this.creatures.splice(index, 1);
                }, 1000);
            }


            
            levelUp() {
                this.player.level++;
                this.player.exp = 0;
                this.player.expToNext = this.player.level * 100;
                this.player.maxHealth += 20;
                this.player.health = this.player.maxHealth;
                
                this.addMessage(`NIVEAU SUPÉRIEUR! Yann atteint le niveau ${this.player.level}!`, "exp");
                this.addMessage(`Santé maximale augmentée! (+20 HP)`, "exp");
                
                // Réduire le temps de spawn des créatures
                this.creatureSpawnRate = Math.max(1000, this.creatureSpawnRate - 200);
            }
            
            gameOver() {
                this.gameRunning = false;
                this.addMessage("Yann s'effondre... La forêt a eu raison de lui.", "combat");
                this.addMessage(`Partie terminée! Niveau atteint: ${this.player.level}`, "");
                
                setTimeout(() => {
                    if (confirm("Yann est tombé au combat. Voulez-vous recommencer l'aventure?")) {
                        location.reload();
                    }
                }, 2000);
            }
            
            updateUI() {
                const healthPercent = (this.player.health / this.player.maxHealth) * 100;
                this.healthFill.style.width = healthPercent + '%';
                this.healthText.textContent = `${Math.floor(this.player.health)}/${this.player.maxHealth}`;
                
                const expPercent = (this.player.exp / this.player.expToNext) * 100;
                this.expFill.style.width = expPercent + '%';
                
                this.levelDisplay.textContent = `Niveau ${this.player.level}`;
            }
            
            addMessage(text, type) {
                const message = document.createElement('div');
                message.className = `message ${type}`;
                message.textContent = text;
                
                this.messages.appendChild(message);
                this.messages.scrollTop = this.messages.scrollHeight;
                
                // Limiter le nombre de messages
                if (this.messages.children.length > 15) {
                    this.messages.removeChild(this.messages.firstChild);
                }
            }
            
            gameLoop() {
            if (!this.gameRunning) return;

            this.movePlayer();
            this.moveCreatures();
            this.updateUI();
            this.updateBackgroundPosition(); // <-- ici

            const now = Date.now();
            if (now - this.lastCreatureSpawn > this.creatureSpawnRate) {
                this.spawnCreature();
                this.lastCreatureSpawn = now;
            }

            requestAnimationFrame(() => this.gameLoop());
        }

        }
        
    </script>
</body>
</html>
